---
# tasks/check_status.yml

- name: Execute pcs booth status command
  command: pcs booth status
  register: booth_status_output
  changed_when: false
  ignore_errors: true

- name: Determine if Booth is running
  ansible.builtin.set_fact:
    booth_running: "{{ booth_status_output.rc == 0 }}"

- name: Parse Ticket Ownership
  ansible.builtin.shell: "pcs booth status | grep 'ticket: {{ booth_ticket_name }}' | awk -F'owned by ' '{print $2}'"
  register: ticket_owner_output
  when: booth_running
  changed_when: false

- name: Set Ticket Owner Fact
  ansible.builtin.set_fact:
    ticket_owner: "{{ ticket_owner_output.stdout | trim if (ticket_owner_output.stdout is defined and ticket_owner_output.stdout | length > 0) else 'None/Unknown' }}"
